<!DOCTYPE html>
<html lang="en">
<head>
    <title>Generate Test</title>
    <th:block th:include="fragments/general.html :: headerfiles">
    </th:block>
</head>
<body>
<header th:insert="fragments/general.html :: userHeader">
</header>
<main>
    <h2 style="text-align: center">
        Generate test
    </h2>
    <form name="generateTest" method="post" onsubmit="return addTestSubmit()">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <div class="mb-3 row">
            <label for="name" class="col-sm-4 col-form-label">Enter name: </label>
            <div class="col-sm-8">
                <input th:value="${previous?.name}"
                       type="text" class="form-control" id="name" name="name">
            </div>
        </div>

        <div class="mb-3 row">
            <label for="selectTestDifficulty" class="col-sm-4 col-form-label"> Select difficulty </label>
            <div class="col-sm-8">
                <select id="selectTestDifficulty" name="difficulty" class="form-select form-select-sm">
                    <option th:each="testDifficulty, testDifficultyStat : ${difficulties}"
                            th:value="${testDifficulty}"
                            th:text="${testDifficulty}"
                            th:selected="${previous ne null and previous.difficulty ne null
                    ? testDifficulty eq previous.difficulty
                    : testDifficultyStat.count == 1}">
                    </option>
                </select>
            </div>
        </div>

        <div class="mb-3 row">
            <label for="startDate" class="col-sm-4 col-form-label"> Select start date: </label>
            <div class="col-sm-8">
                <input class="form-control"
                       th:min="${currentDate}"
                       th:value="${previous ne null and previous.startDate ne null
                        ? previous.startDate
                        : currentDate}"
                       type="datetime-local" id="startDate" name="startDate">
            </div>
        </div>

        <div class="mb-3 row">
            <label for="finishDate" class="col-sm-4 col-form-label"> Select finish date: </label>
            <div class="col-sm-8">
                <input class="form-control"
                       th:min="${currentDate}"
                       th:value="${previous ne null and previous.finishDate ne null
                        ? previous.finishDate
                        : currentDate}"
                       type="datetime-local" id="finishDate" name="finishDate">
            </div>
        </div>

        <div class="mb-3 row">
            <label for="timeLimit" class="col-sm-4 col-form-label"> Select time limit
                (select 0 for unlimited time) </label>
            <div class="col-sm-8">
                <input class="form-control"
                       th:value="${previous ne null and previous.timeLimit ne null
                            ?  previous.timeLimit : '00:00'}"
                       type="time" id="timeLimit" name="timeLimit">
            </div>
        </div>

        <div class="mb-3 row">
            <label for="questionCount" class="col-sm-4 col-form-label"> Enter question count: </label>
            <div class="col-sm-8">
                <input class="form-control"
                       th:value="${previous?.questionsCount}"
                       type="number" min="1" id="questionCount" name="questionsCount">
            </div>
        </div>

        <div class="form-check">
            <input class="form-check-input"
                   th:checked="${previous?.includeMe}"
                   type="checkbox" value="includeMe"
                   name="includeMe" id="includeMe">
            <label class="form-check-label" for="includeMe"> Include me </label>
        </div>

        <div class="mb-3 row">
            <h3>Search for Topics</h3>
            <label for="topicPart" class="col-sm-4 col-form-label"> Enter name: </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="topicPart" name="topicPart">
            </div>
        </div>
        <button type="submit" class="btn btn-primary mb-3" id="searchTopics">Search</button>

        <th:block th:if="${newTopics ne null} or ${!#lists.isEmpty(newTopics)}">
            <p>Choose topics: </p>
            <div class="form-check" th:each="newTopic : ${newTopics}">
                <input class="form-check-input newTopics"
                       type="checkbox" th:value="${newTopic.name}"
                       name="topics" id="topics">
                <label class="form-check-label" for="topics" th:text="${newTopic.name}"></label>
            </div>
        </th:block>

        <div class="mb-3 row">
            <h3>Search for Users</h3>
            <label for="usernamePart" class="col-sm-4 col-form-label"> Enter username: </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="usernamePart" name="usernamePart">
            </div>
        </div>
        <button type="submit" class="btn btn-primary mb-3" id="searchUsers">Search</button>

        <th:block th:if="${newUsers ne null} or ${!#lists.isEmpty(newUsers)}">
            <p>Choose users: </p>
            <div class="form-check" th:each="newUser : ${newUsers}">
                <input class="form-check-input newUsers"
                       th:value="${newUser.username}"
                       type="checkbox" name="usernames" id="usernames">
                <label class="form-check-label" for="usernames" th:text="${newUser.username}"></label>
            </div>
        </th:block>

        <p>Already added topics: </p>
        <div th:if="${previous ne null and previous.topics ne null}
                    and ${!#lists.isEmpty(previous.topics)}">
            <th:block th:each="existingTopic : ${previous.topics}">
                <input th:value="${existingTopic}"
                       class="form-control oldTopics"
                       name="topics" type="text" readonly>
            </th:block>
        </div>

        <p>Already added users: </p>
        <div th:if="${previous ne null and previous.usernames ne null}
                    and ${!#lists.isEmpty(previous.usernames)}">
            <th:block th:each="existingUser : ${previous.usernames}">
                <input th:value="${existingUser}"
                       class="form-control oldUsers"
                       name="usernames" type="text" readonly>
            </th:block>
        </div>

        <div th:replace="fragments/general.html :: error(error=${error})">
        </div>

        <button type="button" class="btn btn-secondary mb-3">
            <a style="color: white" th:href="@{/user/tests}">
                Back
            </a>
        </button>

        <button type="submit" style="float: right"
                class="btn btn-primary mb-3" id="submit"> Generate
        </button>
    </form>
</main>
<footer th:replace="fragments/general.html :: footer">
</footer>
<script src="/static/scripts/generateTest.js" type="text/javascript"></script>
<th:block th:include="fragments/general.html :: scriptfiles">
</th:block>
</body>
</html>